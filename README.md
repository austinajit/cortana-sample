# API.AI Cortana Integration Sample
Sample app using Cortana with interactions generated by API.AI. 

[ApiAiSDK](https://www.nuget.org/packages/ApiAiSDK/) installed to project using Nuget.

## App class

In the constructor of `App` class initialized `AIService`.

```csharp
var config = new AIConfiguration("cb9693af-85ce-4fbf-844a-5563722fc27f",
                                 "40048a5740a1455c9737342154e86946",
                                 SupportedLanguage.English);

AIService = AIService.CreateService(config);
```

Then `AIService` used to process `IActivatedEventArgs` from Cortana in the `OnActivated` method.
```csharp
protected async override void OnActivated(IActivatedEventArgs e)
{
    AIResponse aiResponse = null;
    try
    {
        aiResponse = await AIService.ProcessOnActivatedAsync(e);
    }
    catch (Exception)
    {
        // ignored
    }

    NavigateToMain(aiResponse);
}
```

This code make request to the API.AI service and then start **MainPage** with `AIResponse` parameter. So, API.AI response can be processed on the MainPage (pronounced, for example).

## MainPage class

In the `MainPage` class implemented processing of the `AIResponse` parameter
```csharp
protected override void OnNavigatedTo(NavigationEventArgs e)
{
    ...

    var response = e.Parameter as AIResponse;
    if (response != null)
    {
        var aiResponse = response;
        OutputJson(aiResponse); // print response as JSON to textBlock
        OutputParams(aiResponse); // print action parameters to textBlock
    }
    
   ...
}
```

Also in the MainPage implemented voice requests to the API.AI service and responses pronunciation. See methods `Listen_Click` and `ProcessResult`.

## ApiAiVoiceCommandService class

`ApiAiVoiceCommandService` class demonstrates how to make some background work and return response to Cortana or launch our application.
It initialize `ApiAi` object and use it to make requests to the API.AI and process results.
The main thing you should pay attention is different ways to process command.

```csharp
 switch (voiceCommand.CommandName)
{
    case "type":
        {
            var aiResponse = await apiAi.TextRequestAsync(recognizedText);
            await apiAi.LaunchAppInForegroundAsync(voiceServiceConnection, aiResponse);
        }
        break;
    case "unknown":
        {
            if (!string.IsNullOrEmpty(recognizedText))
            {
                var aiResponse = await apiAi.TextRequestAsync(recognizedText);
                if (aiResponse != null)
                {
                    await apiAi.SendResponseToCortanaAsync(voiceServiceConnection, aiResponse);
                }
            }
        }
        break;
        ...
}
```


